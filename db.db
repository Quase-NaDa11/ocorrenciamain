-- Criar o banco de dados
CREATE DATABASE IF NOT EXISTS ocorrencias;
USE ocorrencias;

-- Tabela de Coordenadores
CREATE TABLE Coordenador (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    senha VARCHAR(255) NOT NULL
);

-- Tabela de Professores
CREATE TABLE Professor (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email_institucional VARCHAR(255) UNIQUE NOT NULL,
    cpf CHAR(14) UNIQUE NOT NULL,
    disciplina VARCHAR(255) NOT NULL,
    senha VARCHAR(255) NOT NULL
);

-- Tabela de Ocorrências
CREATE TABLE Ocorrencia (
    id INT AUTO_INCREMENT PRIMARY KEY,
    estudante VARCHAR(255) NOT NULL,
    aula VARCHAR(255) NOT NULL,
    situacao TEXT NOT NULL,
    turma VARCHAR(50) NOT NULL,
    professor_id INT NULL,
    coordenador_id INT NULL,
    data DATETIME NOT NULL,
    descricao TEXT NOT NULL,
    encaminhamento TEXT,
    status ENUM('pendente', 'andamento', 'concluido') NOT NULL DEFAULT 'pendente',
    FOREIGN KEY (professor_id) REFERENCES Professor(id) ON DELETE SET NULL,
    FOREIGN KEY (coordenador_id) REFERENCES Coordenador(id) ON DELETE SET NULL
);

-- Tabela de Coordenação (recebimento de ocorrências)
CREATE TABLE Coordenacao (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ocorrencia_id INT NOT NULL,
    data_recebimento DATE NOT NULL,
    responsavel_recebimento VARCHAR(255) NOT NULL,
    FOREIGN KEY (ocorrencia_id) REFERENCES Ocorrencia(id) ON DELETE CASCADE
);
